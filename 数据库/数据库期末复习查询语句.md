# 1.关键字及其作用

| 关键字                 | 作用               |
| ---------------------- | ------------------ |
| select                 | 查询               |
| where                  | 过滤非聚合函数条件 |
| group by               | 分组               |
| having                 | 筛选               |
| (left/right outer)join | 连接               |
| order by               | 排序               |
| limit                  | 分页               |
| union                  | 并                 |
| intersect              | 交                 |
| except                 | 差                 |
| describe               | 展示表的属性信息   |
| distinct               | 去重               |

# 2.select

​	1.1查询的内容

```sql
 1.1查询常量
	select 常量值
​ 1.2查询函数结果
	select 函数
​ 1.3查询单个字段
	select [distinct]字段名 from 表名
​ 1.4查询多个字段
	select 字段名1,字段名2... from 表名
​ 1.5查询所有字段
	select * from 表名
​ 1.6查询表达式
	select 表达式
​ 1.6查询某个变量（系统变量和会话用户变量）
	select [@@global/@@session .]变量名
	select @变量名
```

​	1.2过滤

```sql
使用 where 进行筛选
语法: where 过滤条件
 * 一、按条件表达式筛选
		简单条件运算符：> < = != <> >= <=
 * 二、按逻辑表达式筛选
	    逻辑运算符：&& || ! and or not
        作用：用于连接条件表达式
 * 三、模糊查询
​ 	like, not like
 			通配符：%可以表示任意的多个字符，_只能表示任意的一个字符
 			转义字符： \是默认的转义字符，如果要认为指定可以如下(筛选包含百分号的字符串)
 						where like '%&%%' escape '&'	
​ 	between and, not between and
 			between 数字1 and 数字2
 			not between 字符串1 and 字符串2
​   in, not in
    		in(离散值1，离散值2...)
    		not in(离散值1，离散值2...)
 * 四、特殊
​   is null, is not null	
        	*is null: 仅仅可以判断 null 值，可读性较高，建议使用
 	   		*<=>:既可以判断 null 值，又可以判断是否等于普通的数值，可读性较低
 	   			name is null
 	   			name <=> null
 	   			id <=> 
```

# 3.order by

```sql
	1.用在整个查询语句中除了limit以外的最后面，表示依据某些条件进行排序
​	2.排序条件可以有多个，表示先按照某种规则排序，然后再此基础上再排序
​	3.语法: order by 条件 [desc/ asc][,条件2 【desc/asc】......]
​		desc表示降序排序,asc表示升序排序，默认升序排序
​	4.排序的条件：别名，表达式，函数，字段
```

# 4.limit

​	

```sql
语法: limit [offset] size
		offset:要显示的条目的起始索引值，从0开始，
		size:要显示的条目个数
​如果要显示某一页的内容就可以通过页号来计算offset:
		offset = [page-1]*size
​如果不指定offset就表示从0号开始
```

# 5.常见函数:

## 	1.单行函数

### 		1.1字符串函数：

| 函数名      | 函数参数                  | 函数作用                                                     |
| ----------- | ------------------------- | ------------------------------------------------------------ |
| length      | 字段名或字符串            | 获取字节数                                                   |
| char_length | 字段名或字符串            | 获取取字符数                                                 |
| concat      | 字符串1，字符串2.....     | 拼接字符串                                                   |
| upper       | 字符串或字段名            | 字符转大写                                                   |
| lower       | 字符串或字段名            | 字符转小写                                                   |
| substr      | 字符串,i                  | 从第i个字符开始取到最后                                      |
| substr      | 字符串，i，j              | 从第i个字符开始取j个字符                                     |
| instr       | 字符串1，字符串2          | 2在1中第一次出现的字符序号(1开始，0表示没有这个子字符串)     |
| trim        | 字符串                    | 去除掉字符串中所有的空格                                     |
| trim        | 字符串1 from 字符串2      | 去除掉2中所有的1                                             |
| lpad        | 字符串1,i,字符串2         | 在字符串左侧添加字符串2凑够i个字符，如果字符串2不够长就多添加几遍，长度超了就截取 |
| rpad        | 字符串1,i,字符串2         | 在字符串右侧添加字符串2凑够i个字符，如果字符串2不够长就多添加几遍，长度超了就截取 |
| replace     | 字符串1，字符串2，字符串3 | 把1中的2替换成3                                              |

### 		1.2数学函数

| 函数名   | 函数参数            | 函数作用                          |
| -------- | ------------------- | --------------------------------- |
| round    |                     | 对绝对值四舍五入                  |
| round    | +i                  | 保留i位小数                       |
| round    | -i                  | 整数第i位判断4，5对下一位进位舍尾 |
| ceil     | 字段或字段值        | 上取整                            |
| floor    | 字段或字段值        | 下取整                            |
| truncate | 字段或字段值，正负i | 和round类似但是直接舍尾不进位     |
| abs      | 字段或字段值        | 取绝对值                          |
| rand     |                     | 生成随机数（0到1之间的）          |
|          |                     |                                   |

### 		1.3日期函数

#### 					1.3.1日期获取

- [ ] | 函数名          | 函数参数   | 函数作用                                                     |
  | --------------- | ---------- | ------------------------------------------------------------ |
  | ***now***       |            | ***返回现在的日期和时间***                                   |
  | ***curdate***   |            | ***查看现在的日期***                                         |
  | ***curtime***   |            | ***查看现在的时间***                                         |
  | ***year***      | ***date*** | ***返回所给时间中的年***                                     |
  | ***month***     | ***date*** | ***返回所给时间中的月***                                     |
  | ***monthname*** | ***date*** | ***返回所给时间中的月名***                                   |
  | ***day***       | ***date*** | ***返回所给时间中的日***                                     |
  | hour            | date       | 返回所给时间中的小时                                         |
  | minute          | date       | 返回所给时间中的分钟                                         |
  | second          | date       | 返回所给时间中的秒                                           |
  | quarter         | date       | 返回所给时间中的季度                                         |
  | weekofyear      | date       | 返回所给时间是一年中的第几周                                 |
  | dayofyear       | date       | 返回所给时间是一月中的第几天                                 |
  | dayofmonth      | date       | 返回所给时间是一月中的第几天                                 |
  | dayofweek       | date       | 返回所给时间是一周中的第几天                                 |
  | time_to_sec     | date       | 把所给日期中的时间转化成为秒，通过这个转化成的只是把date类型中时间部分进行了转化 |
  | sec_to_time     | date       | 把所给的秒转化成时间，如果通过这个结果查询年月日会显示系统年月日 |

#### 					1.3.2日期计算

| 函数名         | 函数参数                                  | 函数作用                                       |
| -------------- | ----------------------------------------- | ---------------------------------------------- |
| ***adddate***  | ***当前date，i***                         | ***在当前日期基础上加i天***                    |
| ***adddate***  | ***当前date,interval i 单位***            | ***在当前日期基础上加i个单元***                |
| ***adddate***  | ***curdate(),interval '1_1' year_month*** | ***在当前基础上加一年一个月***                 |
| ***subdate***  | ***当前date，i***                         | ***在当前日期基础上减i天（其余的同adddate）*** |
| ***addtime***  | ***当前time,i***                          | ***在当前时间的基础上加i秒***                  |
| ***addtime***  | ***当前time,'i:j:k'***                    | ***在当前基础上加i小时j分钟k秒***              |
| ***addtime***  | ***当前time,'i:j'***                      | ***在当前基础上加i小时j分钟***                 |
| ***subtime***  | ***当前time,i***                          | ***在当前日期基础上减i秒（其余的同addtime）*** |
| ***datediff*** | ***date1，date2***                        | ***返回两次日期之差***                         |
| ***timediff*** | ***time1，time2***                        | ***返回两次时间之差***                         |

#### 					1.3.3格式化

date_format(日期,日期格式)

time_format(时间，时间格式)

%a->周
%b->月的前三个字母
%Y->年的四位数字
%M->月的全英文
%m->月的两位数字
%d->日期的两位数字
%D->日期的叙述表达
%y->两位数字的年



%H->24小时制的小时数字
%i->分钟数字
%s->秒数字

### 1.4.信息函数

​	version()：查询版本信息

​	user():查询用户信息

### 1.5流程控制函数

​	1.5.1 if

​		if(三元表达式)     这里的三元表达式中间每个表达式用逗号隔开

​	1.5.2 case类似于java的switch

```sql
	case(常量或字段)
		when 结果1 then 执行语句
		when 结果2 then 执行语句
        ...
		else 执行语句
		end		

下面这种方式是可以模糊匹配的
​	case
        when 条件一 then 执行语句1
		when 条件二 then 执行语句2
		...
		else 执行语句
		end
```

![image-20240617123940975](C:\Users\11230\AppData\Roaming\Typora\typora-user-images\image-20240617123940975.png)

## 2.聚合函数

​	1.avg(数值)，sum(数值)

​	2.max(数值)，min(数值)

​	3.count(*),count(1),count(字段名)，如果输入的是字段值就是统计非空行数了

# 6.交并差

1.union和union all

```sql
语法: 查询语句 union [all] 查询语句
​作用：并，如果没有all就会进行去重，如果有就不会去重
```

2.intersect

```sql
语法: 查询语句 intersect 查询语句
```

3.except

```sql
语法: 查询语句 except 查询语句
```

# 7.group by

```sql
语法： group by 分组依据 [having] 筛选条件 
​位置： where后面 order by 前面
​作用：查询的是每个分组下的结果，把整个表进行分组，每个组展示成为一条语句
​规则：
	当查询的字段出现非聚合函数的时候就一定要把他作为一个分组依据
	当要根据聚合函数进行筛选的时候就把聚合函数放到 having的条件当中，如果放到 where里面会报错，非聚合函数的部分建议放到 where里面,因为 where的执行效率比较高
​语句执行顺序： 
	from -> Where -> group by -> having -> select -> order by -> limit
```

# 8.连接：

​	交叉连接:	

```sql
求的就是笛卡尔积：
​有两种方法
  	1.from 表1，表2
  	2.from 表1 cross join 表2
```

​	内连接:

```sql
语法: from 表1 [inner] join 表2 on 连接条件
```

​	外连接

```sql
1.左外连接
	语法: from 表1 left outer join 表2 on 连接条件
2.右外连接
	语法: from 表1 right outer join 表2 on 连接条件
3.全外连接
	语法: 左外连接查询语句 union 右外连接查询语句
```

​	自然连接

```sql
对于两个表中的同一属性进行合并，然后把这一属性值相同的行保留下来
from 表1 natural join 表2 
```

​	多表连接

```sql
from 表1 join 表2 on 表1表2连接条件 join 表3 on 表3和刚才形成的表的连接条件
```

# 9.子查询

## 1.子查询类型

​	1.标量子查询

```sql
把要查询的一行一列的结果当作一个数据放在 where 的条件当中，从而限制查询结果
例如在buy_kind_product表里查询总价比orders表里订单号是‘1718452959982’的高的元组
 select * from buy_kind_product where sum_price>(select sum_price from orders where order_id='1718452959982');
```

​	2.列子查询

```sql
把一列多行的数据查询出来之后当成多个离散值让in，any等进行选择
In 某个数据和通过子查询得到的这好几行的结果中的每一个值比较，相同的行就留下（离散值）
Any / some 跟单行操作符搭配使用，意思是和子查询中的某个值比较能成功就行
All 和子查询中所有的值进行比较都能成功才行
```

​	3.行子查询

```sql
一行多列，可以把属性名当作一个集合来放在where里
eg:查询manager_id以及department_id 与140号员工相同的
select employee_id, manager_id,department_id from employees where(manager_id,department_id)=(select manager_id,department_id from employeeswhere employee_id =140)

```

​	4.表子查询

```sql
就是把刚才的表的查询弄成两个不同的表之间的查询
```

## 2.子查询格式

​	select 标量 from 表 where 标量、行、列、表

## 3.注意:

​	子查询需要用小括号包围
​	子查询放在条件的右侧
​	标量子查询搭配单行操作符例如=
​	子查询的执行比主查寻的执行优先级高
​	列子查询一般搭配多行操作符例如in	

### 4.附：

​	select 后面可以直接来个标量子查询，如果想要查询的结果中既有多行函数又有其他字段就直接把多行函数当都列出来一个标量子查询，因为如果多行函数和其他字段同时出现时需要分组，你不想分组就只能这样

​	如果from 后面就是个子查询查出来的表就要给这个表起个别名

​	select exists 子查询：作用是检查是否子查询有结果，空表就是0有数据就是1

​	
